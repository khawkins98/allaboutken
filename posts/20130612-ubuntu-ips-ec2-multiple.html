<!doctype html> <html class="no-js" lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="x-ua-compatible" content="ie=edge"> <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes"> <title>Muliple IPs on an Ubuntu EC2 VPC? Yes, please! > All about Ken</title> <style type="text/css">div,h1,li,p,ul{margin:0;padding:0}h1{font-family:ibm-plex-sans,"Fira Sans",Arial,sans-serif;font-style:normal;font-weight:800;color:inherit;text-rendering:optimizeLegibility}h1 small{line-height:0;color:#cacaca}h1.tight-leading{line-height:2rem}h1>small{color:#fefefe;font-size:1.5rem;display:inline-block;font-weight:400}html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}a{background-color:transparent;-webkit-text-decoration-skip:objects}strong{font-weight:inherit}strong{font-weight:bolder}code{font-family:monospace,monospace;font-size:1em}small{font-size:80%}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{box-sizing:border-box;font-size:110%}*,::after,::before{box-sizing:inherit}body{margin:0;padding:0;background:#7759c3;font-family:ibm-plex-sans,"Fira Sans",Arial,sans-serif;font-weight:400;line-height:1.5;color:#fefefe;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.grid-container{padding-right:.56818rem;padding-left:.56818rem;max-width:71.02273rem;margin:0 auto}.grid-x{display:-ms-flexbox;display:flex;-ms-flex-flow:row wrap;flex-flow:row wrap}.cell{-ms-flex:0 0 auto;flex:0 0 auto;min-height:0;min-width:0;width:100%}.cell.auto{-ms-flex:1 1 0px;flex:1 1 0px}.grid-x>.auto{width:auto}.grid-x>.small-12{-ms-flex-preferred-size:auto;flex-basis:auto}.grid-x>.small-12{width:100%}.grid-padding-x .grid-padding-x{margin-right:-.56818rem;margin-left:-.56818rem}.grid-container:not(.full)>.grid-padding-x{margin-right:-.56818rem;margin-left:-.56818rem}.grid-padding-x>.cell{padding-right:.56818rem;padding-left:.56818rem}@media print,screen and (min-width:40em){.grid-container{padding-right:.85227rem;padding-left:.85227rem}.grid-x>.medium-1,.grid-x>.medium-10,.grid-x>.medium-5{-ms-flex-preferred-size:auto;flex-basis:auto}.grid-x>.medium-1{width:8.33333%}.grid-x>.medium-5{width:41.66667%}.grid-x>.medium-10{width:83.33333%}.grid-padding-x .grid-padding-x{margin-right:-.85227rem;margin-left:-.85227rem}.grid-container:not(.full)>.grid-padding-x{margin-right:-.85227rem;margin-left:-.85227rem}.grid-padding-x>.cell{padding-right:.85227rem;padding-left:.85227rem}}.small-up-1>.cell{width:100%}div,h1,h2,h3,li,p,ul{margin:0;padding:0}p{margin-bottom:1rem;font-size:inherit;line-height:1.6;text-rendering:optimizeLegibility}strong{font-weight:800;line-height:inherit}small{font-size:80%;line-height:inherit}h1,h2,h3{font-family:ibm-plex-sans,"Fira Sans",Arial,sans-serif;font-style:normal;font-weight:800;color:inherit;text-rendering:optimizeLegibility}h1 small,h2 small{line-height:0;color:#cacaca}h1{font-size:1.36364rem;line-height:1.4;margin-top:0;margin-bottom:.5rem}h2{font-size:1.13636rem;line-height:1.4;margin-top:0;margin-bottom:.5rem}h3{font-size:1.07955rem;line-height:1.4;margin-top:0;margin-bottom:.5rem}@media print,screen and (min-width:40em){.medium-up-4>.cell{width:25%}h1{font-size:3.63636rem}h2{font-size:2.27273rem}h3{font-size:1.76136rem}}a{line-height:inherit;color:#7759c3;text-decoration:none}hr{clear:both;max-width:71.02273rem;height:0;margin:1.13636rem auto;border-top:0;border-right:0;border-bottom:1px solid #cacaca;border-left:0}ul{margin-bottom:1rem;list-style-position:outside;line-height:1.6}li{font-size:inherit}ul{margin-left:1.25rem;list-style-type:disc}code{padding:.11364rem .28409rem .05682rem;border:none;background-color:rgba(254,254,254,.1);font-family:ibm-plex-code,"Fira Code",Courier,monospace;font-weight:400;color:#fefefe}.menu{padding:0;margin:0;list-style:none;position:relative;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap}.menu a{line-height:1;text-decoration:none;display:block;padding:.7rem 1rem}.menu a{margin-bottom:0}.menu{-ms-flex-wrap:wrap;flex-wrap:wrap;-ms-flex-direction:row;flex-direction:row}.menu .is-active>a{background:#7759c3;color:#fefefe}@media screen and (max-width:39.9375em){.show-for-medium{display:none!important}}@media screen and (max-width:39.9375em),screen and (min-width:75em){.show-for-medium-only{display:none!important}}@media screen and (max-width:74.9375em){.show-for-large{display:none!important}}html{background:#000}hr{display:block;height:1px;border:0;border-top:1px solid #ccc;margin:1em 0;padding:0}.no-bullet ul{list-style-type:none;text-indent:-1rem}.main-content-area a:link,.main-content-area a:visited{color:inherit}.main-content-area a:link{text-decoration:none;background:linear-gradient(#7759c3,#7759c3),linear-gradient(#7759c3,#7759c3),linear-gradient(#fff,#fff);background-size:.05em 1px,.05em 1px,1px 1px;background-repeat:no-repeat,no-repeat,repeat-x;background-position:0 93%,100% 93%,0 93%}@media screen and (-webkit-min-device-pixel-ratio:0){.main-content-area a:link{background-position-y:87%,87%,87%}}@media (max-width:760px){ul{width:85%}}.margin-top-none{margin-top:0}.margin-top-xlarge{margin-top:2rem}.margin-bottom-none{margin-bottom:0}.margin-bottom-xlarge{margin-bottom:2rem}.padding-top-xlarge{padding-top:2rem}.padding-bottom-medium{padding-bottom:.5rem}.padding-bottom-xlarge{padding-bottom:2rem}.float-right{float:right}.float-left{float:left}.black-background{background:#0a0a0a}.emoji{font-family:Noto-Emoji}body.gradient{background:linear-gradient(to bottom,#7759c3 0,#2970ad 99%)}code{font-size:.8rem}h1{font-size:3rem}h2{font-size:2.36364rem}h3{font-size:1.2rem}.block{display:block}a.only-hover:link{background:0 0}.menu li a{color:#fefefe}.menu .is-active>a{background:#444;color:#fefefe}h1.tight-leading,h2.tight-leading{line-height:2rem}h1>small,h2>small{color:#fefefe;font-size:1.5rem;display:inline-block;font-weight:400}strong{letter-spacing:.5px}@media screen{.show-for-print-only{display:none}}.emoji{font-weight:400!important} </style> <link rel="preload" href="https://khawkins98.github.io/allaboutken-framework/css/allaboutken-framework.css" as="style" onload="this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="https://khawkins98.github.io/allaboutken-framework/css/allaboutken-framework.css"></noscript> <link rel="preload" href="../app.css" as="style" onload="this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="../app.css"></noscript> <script>!function(e){"use strict";var t=function(t,n,r){function o(e){if(i.body)return e();setTimeout(function(){o(e)})}function a(){d.addEventListener&&d.removeEventListener("load",a),d.media=r||"all"}var l,i=e.document,d=i.createElement("link");if(n)l=n;else{var s=(i.body||i.getElementsByTagName("head")[0]).childNodes;l=s[s.length-1]}var u=i.styleSheets;d.rel="stylesheet",d.href=t,d.media="only x",o(function(){l.parentNode.insertBefore(d,n?l:l.nextSibling)});var f=function(e){for(var t=d.href,n=u.length;n--;)if(u[n].href===t)return e();setTimeout(function(){f(e)})};return d.addEventListener&&d.addEventListener("load",a),d.onloadcssdefined=f,f(a),d};"undefined"!=typeof exports?exports.loadCSS=t:e.loadCSS=t}("undefined"!=typeof global?global:this),function(e){if(e.loadCSS){var t=loadCSS.relpreload={};if(t.support=function(){try{return e.document.createElement("link").relList.supports("preload")}catch(e){return!1}},t.poly=function(){for(var t=e.document.getElementsByTagName("link"),n=0;n<t.length;n++){var r=t[n];"preload"===r.rel&&"style"===r.getAttribute("as")&&(e.loadCSS(r.href,r,r.getAttribute("media")),r.rel=null)}},!t.support()){t.poly();var n=e.setInterval(t.poly,300);e.addEventListener&&e.addEventListener("load",function(){t.poly(),e.clearInterval(n)}),e.attachEvent&&e.attachEvent("onload",function(){e.clearInterval(n)})}}}(this);</script> <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png?v=kPxQgGG9A2"> <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png?v=kPxQgGG9A2"> <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png?v=kPxQgGG9A2"> <link rel="manifest" href="/manifest.json?v=kPxQgGG9A2"> <link rel="mask-icon" href="/favicons/safari-pinned-tab.svg?v=kPxQgGG9A2" color="#7759c3"> <link rel="shortcut icon" href="/favicon.ico?v=kPxQgGG9A2"> <meta name="theme-color" content="#7759c3"> <meta name="description" content="Hello. I am Ken Hawkins. Builder of websites, project planner, newspaper nerd, information architect, lover of UX, consultant. Information structure is my thing."> <meta name="MobileOptimized" content="width"> <meta name="HandheldFriendly" content="true"> <meta name="abstract" content="Hello. I am Ken Hawkins. Builder of websites, project planner, newspaper nerd, information architect, lover of UX, consultant. Information structure is my thing."> <meta name="apple-mobile-web-app-capable" content="yes"> <meta name="keywords" content="Drupal, web development, Ken Hawkins, UX, information architecture"> <!-- <link rel="canonical" href="http://allaboutken.com/" />
    <link rel="shortlink" href="http://allaboutken.com/" /> --> <meta property="og:type" content="website"> <meta property="og:site_name" content="All About Ken Hawkins"> <meta property="og:url" content="https://work.allaboutken.com/"> <meta property="og:title" content="Muliple IPs on an Ubuntu EC2 VPC? Yes, please! > All About Ken Hawkins"> <meta property="og:image" content="https://work.allaboutken.com/images/crop-cinema/blog/ethernet.jpg"> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="@khawkins98"> <meta name="twitter:site:id" content="3723201"> <meta name="twitter:creator" content="@khawkins98"> <meta name="twitter:creator:id" content="3723201"> <meta name="twitter:url" content="https://work.allaboutken.com/"> <meta name="twitter:description" content="Configuring a second ethernet adapter on an Ubuntu EC2 VPC instance."> <meta name="twitter:image" content="https://work.allaboutken.com/images/crop-cinema/blog/ethernet.jpg"> <meta name="dcterms.title" content="Muliple IPs on an Ubuntu EC2 VPC? Yes, please! > All About Ken Hawkins"> <meta name="dcterms.type" content="Text"> <meta name="dcterms.identifier" content="http://allaboutken.com/"> <meta name="dcterms.format" content="text/html"> <link rel="alternate" type="application/rss+xml" title="RSS" href="http://work.allaboutken.com/rss.xml"> <script src="/sw-register.js"></script> </head> <body class="gradient"> <div class="grid-x grid-padding-x black-background"> <div class="medium-1 show-for-medium cell do-not-print"></div> <div class="small-12 medium-10 cell"> <div class="grid-x do-not-print"> <div class="cell medium-5"> <ul class="menu float-left"> <li class=""><a href="../">AllAboutKen<span class="show-for-large">.com</span></a> </li> <li class="is-active"><a href="../blog">Blog</a></li> </ul> </div> <div class="cell auto"> <ul class="menu float-right show-for-medium"> <!-- <span class="dev-explainer">Would have been easy enough to just do icons here, but text is not only better SEO but there's not mystery as to the action of what these links do.</span> --> <li class="show-for-medium-only"><a href="mailto:khawkins98@gmail.com">E-mail</a></li> <li class="show-for-large"><a href="mailto:khawkins98@gmail.com">khawkins98@gmail.com</a></li> <li class=""><a href="https://twitter.com/khawkins98">Twitter<span class="show-for-large"> @khawkins98</span></a></li> <li class=""><a href="https://www.linkedin.com/in/allaboutken">LinkedIn</a></li> </ul> </div> </div> </div> </div> <div class="grid-container"> <div class="grid-x grid-padding-x main-content-area" id="main-content-area"> <div class="medium-1 show-for-medium cell do-not-print"></div> <div class="small-12 medium-10 print-12 cell"> <div class="padding-top-xlarge"></div> <div class="columns medium-12"> <img class="callout" src="../images/crop-cinema/blog/ethernet.jpg"> <p>2013.6.12</p> <h1>Muliple IPs on an Ubuntu EC2 VPC? Yes, please!</h1> <p class="lead">Subtitled: Configuring a second ethernet adapter on an Ubuntu EC2 VPC instance</p> <p>If you're wanting to have multiple valid SSL certificates for many domains (say, for Drupal a multisite running on Aegir) on a single EC2 instance you'll, of course, need multiple IP addresses. While Amazon's VPC offerings seem like an easy win there are a few twists to get the server to respond to that second internal IP.</p> <p>Here are my notes, hopefully they'll be of some use to you. You might not need to do all of these, but I've found things to work better this way. These steps were used on Ubuntu 12.04 in June 2012 ‚Äî things can change.</p> <blockquote> <p><strong>Get set up:</strong></p> </blockquote> <ul> <li>Have one unique internal IP address (10.0.0.70, 10.0.0.80, etc) per network adapter</li> <li>Map the Elastic IP addresses to your internal IP</li> <li>I'm running Aegir and needed to map the Apache server not to the public IP used for the domain name, but the private internal IP address</li> </ul> <p>Once you've done the the above, you'll likely find the server working fine on the first IP address but not responding on the second.</p> <p>Here's what to do next:</p> <ol> <li>In the Amazon VPC Route Table console ensure you have a route entry for 0.0.0.0/0 using your IGW (this will look like igw-xxxxxx)</li> <li>SSH into your server</li> <li>If not root: <code>sudo su - root</code></li> <li>Initialize your secondary ethernet interface (don't do this for <code>eth0</code>)</li> </ol> <ul> <li><code>ifconfig eth1 10.0.0.YOURIPHERE netmask 255.255.255.0</code></li> </ul> <ol> <li>Set up your interfaces</li> </ol> <ul> <li><code>vi /etc/network/interfaces</code></li> <li>For each adapter add (changing &quot;1&quot; for your adapter) <ul> <li><code>auto eth1</code></li> <li><code>iface eth1 inet dhcp</code></li> </ul></li> <li>Start each adapter <code>ifup eth1</code></li> <li>We should be able to <code>ifconfig</code> and see the ethernet adapters up</li> <li>Reboot <ul> <li><code>init 6</code></li> </ul></li> <li>SSH into your server, become root</li> <li>For each ethernet adapter follow this pattern: <ul> <li><code>ip route add default via 10.0.0.1 dev eth0 tab 1</code></li> <li><code>ip route add default via 10.0.0.1 dev eth1 tab 2</code></li> <li>Similarly: <ul> <li><code>ip rule add from 10.0.0.170/32 tab 1 priority 500</code></li> <li><code>ip rule add from 10.0.0.190/32 tab 2 priority 600</code></li> </ul></li> </ul></li> </ul> <h3>Almost done</h3> <p>Good news is it works at this point, bad news is the ip routes and rules won't survive a reboot.</p> <p>Let's make changes survive a reboot:</p> <ul> <li><p>Return to <code>vi /etc/network/interfaces</code>; our file should look like:</p> <pre><code># The loopback network interface
auto lo
iface lo inet loopback
# The primary network interface
auto eth0
iface eth0 inet dhcp
auto eth1
iface eth1 inet dhcp
</code></pre></li> <li><p>We modify the above, adding in the ip route and ip rule commands from before, but prefixing them with &quot;post-up&quot;, like so:</p></li> </ul> <pre><code># The loopback network interface
auto lo
iface lo inet loopback
# The primary network interface
auto eth0
iface eth0 inet dhcp
  post-up ip route add default via 10.0.0.1 dev eth0 tab 1
  post-up ip rule add from 10.0.0.170/32 tab 1 priority 500
auto eth1
iface eth1 inet dhcp
  post-up ip route add default via 10.0.0.1 dev eth1 tab 2
  post-up ip rule add from 10.0.0.190/32 tab 2 priority 600
</code></pre> <p>Now reboot <code>/etc/init.d/networking restart</code></p> <p>All set!</p> <h4>Related reading and things that helped me:</h4> <ul> <li>AWS Forums: <a href="https://forums.aws.amazon.com/message.jspa?messageID=404454">Unable to connect to EC2 instance in VPC</a></li> <li>Getting ip rules and routes to work on reboot: <a href="http://www.cyberciti.biz/faq/ubuntu-linux-add-static-routing/">Ubuntu Linux Add Static Route</a></li> <li>Video on EC2 VPC multiple IP basics: <a href="http://www.youtube.com/watch?v=Z_MWQ75GtvE">How to add extra IP addresses on one EC2 Instance</a></li> </ul> <p><cite>Image credit: <a href="https://www.flickr.com/photos/tueksta/839920747#">Flickr user &quot;Andreas Beer&quot;</a></cite></p> </div> <div class="margin-top-xlarge padding-top-xlarge"> <p><a href="../blog" class=""><span class="emoji">‚¨ÖÔ∏è</span> There's more to read on the blog overview</a></p> </div> <div class="grid-x grid-padding-x margin-top-xlarge padding-bottom-xlarge"> <div class="cell medium-12 callout small"> <h3>I'm Ken Hawkins</h3> <p>I do web architecture, holistic design, and a bit of UX and development.<br> If you want to learn more about me and what I do <a href="../">head to the front page</a>, or:</p> <div class="margin-left-medium"> <ul class="no-bullet"> <li class="">&nbsp; <span class="emoji">üê¶</span> <a href="https://twitter.com/khawkins98">Twitter<span class="show-for-large"> @khawkins98</span></a></li> <li class="">&nbsp; <span class="emoji">üì¨</span> <a href="..//rss.xml">RSS feed</a></li> <li class="">&nbsp; <span class="emoji">üìà</span> <a href="https://www.linkedin.com/in/allaboutken">LinkedIn</a></li> <li class="show-for-medium-only">&nbsp; <span class="emoji">‚úâÔ∏è</span> <a href="mailto:khawkins98@gmail.com">E-mail</a></li> <li class="show-for-large">&nbsp; <span class="emoji">‚úâÔ∏è</span> <a href="mailto:khawkins98@gmail.com">khawkins98@gmail.com</a></li> </ul> </div> </div> <div class="cell medium-12"> <h3>This site is a playground <span class="emoji">üôà</span></h3> <p>What you're seeing was made with a combination <sup><a href="https://github.com/khawkins98/allaboutken/blob/master/gulpfile.js">1</a></sup> <sup><a href="https://github.com/khawkins98/allaboutken/blob/master/package.json">2</a></sup> of the Foundation Framework, CSS/Sass, responsive design, Gulp, Panini static site generator, Markdown and some other stuff and then hosted through Travis CI and Github pages<sup><a href="https://github.com/khawkins98/allaboutken/blob/master/.travis.yml">3</a></sup>.</p> <p>In years past I would have likely made this site with Drupal, but for smaller sites with savvy editors I've been using static site combinations to simplify maintenance.</p> </div> </div> </div> </div> <div class="small-12 do-not-print cell"> <p><a class="float-right small" href="/privacy">Curious about privacy?</a></p> </div> <code class="show-for-print-only small">Printed direct from AllAboutKen.com</code> </div> </body> </html> 